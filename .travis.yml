sudo: required

services:
  - docker

language: go

go:
  - 1.7

env:
  global:
    - MYAPP=sscg
    - MYEMAIL=mh-cbon@users.noreply.github.com
    - secure: XMUGAItrntTLHbfzfdLIgQOzIWoGHGiIugQFoLq6L0KzKCi6fUb59xI3CXySQFb5sEeDQ//iFVbmJwZNzz4D6n7sqX/i0ccjEbY8tmjeF2dhYnstpBUh2Q+pO0XnZKxhOSqunAs0o8VZJ32oB37NW5ksPcXsMVtRNEaZCSEdng+l1KjzfAJyUYViD6qAjuvwSuBM0jzispQzwbFs5u6pV9KzmnVXCKd3y3lJvt9hsiauENAGjM+lxZgR626Sclhv3i4uxrwoFRKFjxeeykOIO9MR29rBpDVijexFg9a27ooRpKoeQgvFbJo+La7f2ITKcZmfDLBWlt8DbisD5rXSsc+nUE65bhAOzX+dtIrTqPdxgOQYsE3xoUfeskXNOjVqTRtxBBv/7vcs4sjKlAwsGrG9lsusmdUiQ4zNinh8eruYoxXMXd91z6TikRKSJGxkFEj42KZ5PaDsWqe70ax8AvPgkqdTOrOGmHLUZqA1dJTBpFCEwSQMVM10UEBPgjjgX+ZvKS7zck2v6LHRu+uJFkI4AwZIJgZmhqa+Nz5yFuaKu4MgtIPhlBpDTyVz9H1WuuXpBZGI8HpKY5VBpnO0olUsLBRz5dr7yjkCueLSeoVxm8Wf+5sTd3Xbmf2JaD/XlAR/FKNz6zoUGlOwxVp+GolDbFf5SUp/CtMcAWbWPHI=

before_install:
  - sudo apt-get -qq update
  - mkdir -p ${GOPATH}/bin
  - cd ~
  - curl https://glide.sh/get | sh

install:
  - cd $GOPATH/src/github.com/mh-cbon/$MYAPP
  - glide install
  - go install

script: echo "pass"

before_deploy:
  - mkdir -p build/{386,amd64}
  - GOOS=linux GOARCH=386 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/386/$MYAPP main.go
  - GOOS=linux GOARCH=amd64 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/amd64/$MYAPP main.go
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/create-pkg.sh | GH=mh-cbon/$MYAPP sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/create-pkg.sh | GH=mh-cbon/$MYAPP sh -xe

after_deploy:
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/setup-repository.sh | GH=mh-cbon/$MYAPP EMAIL=$MYEMAIL sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/setup-repository.sh | GH=mh-cbon/$MYAPP EMAIL=$MYEMAIL sh -xe

deploy:
  provider: releases
  api_key:
    secure: vuXLo9vwxqYywYxfAEYPeOMX1/TZUc5yaoxa7qBr1jXjmONXb0M2YVsKEDYtDNTxr4N4+5XRRNJ6m/EAJy3sztZ5dtgG8fDFxW+CkAe+hg8QyEakth164JFxAhKbMvcDkAG4Cb+38oDpXgFzdUK1JxUCMp9ZD2T0zMSEg8ucBWw8UurxoI7o5jpnPM7wG+fEXvYSDFTDaHymL4c3xkG4KoQ/UZ5Xn51+0G9eHZmK/1bYBVwUPWyS+eIt57m4Ckv7a9bcFxo2ZlPPNtqi6hgqJyPpqZ9YcBpXbpjSxRzI369jQnl5bNCnIfKQQABzLgDg7+kMXT6haWYw6ZjPyPVaWLir5hTLXcd8rStZDonKHcIiWAIuGXAavf1O4knaEUpmPOCBIjrFB0BlZtAT3Ez74hrcPYXgQiA23sp5McozTmJlU8JT7zx+YGUNXXzU2rSR11kc65M2OR0wrI8DtGBix/gjhD4iAjd1TAKYUBeDelSv4K1DVF7+qzjGPyYWxKDDpjwmavPSAMR/FDBEkFa1E/EiNHASFEGqICYECPz5reBsKDAdGx02s5XZ2ab5VhFB+kZo+HyQD6rcy97lSC4tNHfvQW0EhkXDlM0Xk2QVaydAel9dWClgDaZixxSUYgcp/IVqLV5VY90uRLoxgTh5B+khA9UInxD5XUfw2qEHkMY=
  file_glob: true
  file:
    - $MYAPP-386.deb
    - $MYAPP-amd64.deb
    - $MYAPP-386.rpm
    - $MYAPP-amd64.rpm
  skip_cleanup: true
  on:
    tags: true
